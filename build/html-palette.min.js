/* html-palette v1.0.1 - built on 2015-11-25 */
"use strict";!function(a,b){function c(a,b,c){if(0===b)return{r:c,g:c,b:c};var d=Math.floor(6*a),e=6*a-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-b*(1-e));switch(d%6){case 0:return{r:c,g:h,b:f};case 1:return{r:g,g:c,b:f};case 2:return{r:f,g:c,b:h};case 3:return{r:f,g:g,b:c};case 4:return{r:h,g:f,b:c};default:return{r:c,g:f,b:g}}}function d(a,b,c){var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function e(a,b){this.triggerElem=a,this.colorCallback=b.colorCallback||null,this.popupEdge=b.popupEdge||"se",this.radial=b.radial||!1,this.useAlpha=b.useAlpha||!1,this.updateTriggerBg=void 0!==b.updateTriggerBg?b.updateTriggerBg:!0,this.disabled=b.disabled||!1,this.selection=b.initialColor||"aaaaaa",j.initialize();var c=this;a.addEventListener("click",this._clickHandler=function(a){b.disabled||(j.triggerElem=c.triggerElem,j.colorCallback=function(a){if(c.selection=a,c.updateTriggerBg){var b=[Math.round(255*a.r),Math.round(255*a.g),Math.round(255*a.b),a.a];b="rgba("+b.join(",")+")",c.triggerElem.style.background="linear-gradient("+b+","+b+"), url("+i+")"}c.colorCallback&&c.colorCallback(a)},j.show({radial:c.radial,useAlpha:c.useAlpha,popupEdge:c.popupEdge,css:c.css,color:c.selection},a))})}var f='<div class="palette">\n	<canvas width="1" height="1"></canvas>\n	<div class="alpha" draggable="true"></div>\n	<div class="twoaxis" draggable="true"></div>\n	<div class="oneaxis" draggable="true"></div>\n</div>\n<div class="controls">\n	<div class="rgbInput">\n		#\n		<span class="r" draggable="true"></span>\n		<span class="g" draggable="true"></span>\n		<span class="b" draggable="true"></span>\n		<span class="a" draggable="true"></span>\n	</div>\n	<div class="colorswatch"></div>\n</div>\n',g="precision lowp float;\nattribute vec3 vertPosition;\nvarying vec2 windowPosition;\nuniform vec2 windowDimensions;\n\nvoid main(void)\n{\n	mat3 xform = mat3(0.5*windowDimensions.x, 0.0, 0.0, 0.0, 0.5*windowDimensions.y, 0.0, windowDimensions.x/2.0, windowDimensions.y/2.0, 1.0);\n	windowPosition = (xform * vec3(vertPosition.xy, 1.0)).xy;\n	gl_Position = vec4(vertPosition,1);\n}\n\n",h="precision lowp float;\n#define M_PI 3.141592653589\n\nvarying vec2 windowPosition;\nuniform vec4 selectedColor;\nuniform float swatchWidth;\nuniform float marginWidth;\nuniform vec2 windowDimensions;\nuniform bool radial;\nuniform bool useAlpha;\nuniform sampler2D tex;\n\nvec3 hsv2rgb(vec3 c){\n	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec4 getSelectionColor(vec4 baseColor){\n	return vec4( vec3(1.0)-baseColor.rgb, baseColor.a );\n}\n\nvoid main(void){\n\n	float taLeft = useAlpha ? swatchWidth + marginWidth : 0.0;\n	float taWidth = windowDimensions.x - swatchWidth - marginWidth - taLeft;\n	vec2 center = vec2(taWidth/2.0+taLeft, windowDimensions.y/2.0);\n	float aspect = taWidth / windowDimensions.y;\n	vec4 color;\n	vec2 selectionPosition;\n\n	if( windowPosition.x >= taLeft &&  windowPosition.x <= taLeft+taWidth )\n	{\n		if(radial)\n		{\n			vec2 radialVec = (windowPosition - center)*vec2(2.0/taWidth, 2.0/windowDimensions.y);\n			radialVec = mat2(max(1.0,aspect), 0.0, 0.0, max(1.0,1.0/aspect)) * radialVec;\n			if(length(radialVec) > 1.0) discard;\n			float hue = atan(radialVec.y,radialVec.x)/(2.0*M_PI) + 0.5;\n			color = vec4(hue, length(radialVec), selectedColor.z, 1.0);\n\n			float angle = (selectedColor.x-0.5)*2.0*M_PI;\n			selectionPosition = min(center.x-taLeft, center.y) * selectedColor.y * vec2(cos(angle), sin(angle)) + center;\n		}\n		else {\n			color = vec4((windowPosition.x-taLeft)/taWidth, windowPosition.y/windowDimensions.y, selectedColor.z, 1.0);\n			selectionPosition = vec2(selectedColor.x*taWidth+taLeft, selectedColor.y*windowDimensions.y);\n		}\n\n		vec2 difference = selectionPosition - windowPosition;\n		float radius = length(difference);\n\n		if( radius > 4.5 && radius < 6.0 )\n			gl_FragColor = getSelectionColor(vec4(hsv2rgb(color.xyz), 1.0 ));\n		else\n			gl_FragColor = vec4( hsv2rgb(color.xyz), 1.0);\n	}\n\n	else if(useAlpha && windowPosition.x < swatchWidth)\n	{\n		vec4 color = vec4(mix( texture2D(tex, windowPosition/16.0).xyz, hsv2rgb(selectedColor.xyz), windowPosition.y/windowDimensions.y), 1.0);\n\n		if( windowDimensions.y * abs(windowPosition.y/windowDimensions.y-selectedColor.w) < 1.0 )\n			gl_FragColor = getSelectionColor(color);\n		else\n			gl_FragColor = color;\n	}\n\n	else if(windowPosition.x > windowDimensions.x-swatchWidth)\n	{\n		vec4 color = vec4( selectedColor.x, selectedColor.y, windowPosition.y/windowDimensions.y, 1.0);\n\n		if( windowDimensions.y * abs(windowPosition.y/windowDimensions.y-selectedColor.z) < 1.0 )\n			gl_FragColor = getSelectionColor(vec4(hsv2rgb(color.xyz), 1.0 ));\n		else\n			gl_FragColor = vec4( hsv2rgb(color.xyz), 1.0);\n	}\n	else\n		discard;\n}\n\n",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAK0lEQVQoz2Pcu3cvAzbg5OSEVZyJgUQwqoEYwPj//3+sEvv27RsNJfppAAD+GAhT8tRPqwAAAABJRU5ErkJggg==",j={colorCallback:null,elem:document.createElement("div"),selection:{},initialize:function(){function a(a,b){a.ondragstart=function(a){r=Math.round(255*n.selection[b]),s=a.offsetY,a.dataTransfer.effectAllowed="none",a.dataTransfer.setDragImage(document.createElement("div"),0,0)},a.ondrag=function(a){var c=r+s-a.offsetY;if(0!==a.screenX||0!==a.screenY){var d={};d[b]=Math.max(0,Math.min(1,c/255)),n.color(d)}}}if(!document.getElementById("htmlPalettePopup")){this.elem=document.createElement("div"),this.elem.id="htmlPalettePopup",this.elem.innerHTML=f,this.elem.onclick=function(a){a.stopPropagation()},this.elem.style.display="none",document.body.appendChild(this.elem),document.addEventListener("click",function(a){document.getElementById("htmlPalettePopup").style.display="none"}),this.canvas=this.elem.children[0].children[0],this.gl=this.canvas.getContext("webgl");var b=this.gl,c=b.createShader(b.VERTEX_SHADER);if(b.shaderSource(c,g),b.compileShader(c),!b.getShaderParameter(c,b.COMPILE_STATUS))return void console.error("Vert shader error:",b.getShaderInfoLog(c));var d=b.createShader(b.FRAGMENT_SHADER);if(b.shaderSource(d,h),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))return void console.error("Frag shader error:",b.getShaderInfoLog(d));var e=this._program=b.createProgram();if(b.attachShader(e,c),b.attachShader(e,d),b.linkProgram(e),!b.getProgramParameter(e,b.LINK_STATUS))return void console.error("Unable to link program");b.useProgram(e),this._program=e;var j=b.getAttribLocation(e,"vertPosition");b.enableVertexAttribArray(j);var k=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,k),b.bufferData(b.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),b.STATIC_DRAW),b.vertexAttribPointer(j,3,b.FLOAT,!1,0,0),b.uniform1f(b.getUniformLocation(e,"swatchWidth"),20),b.uniform1f(b.getUniformLocation(e,"marginWidth"),10);var l=b.createTexture(),m=new Image;m.onload=function(){b.bindTexture(b.TEXTURE_2D,l),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST)},m.src=i,b.clearColor(0,0,0,0);var n=this,o=this.elem.querySelector(".twoaxis"),p=this.elem.querySelector(".oneaxis"),q=this.elem.querySelector(".alpha");o.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},o.ondrag=o.onmousedown=function(a){var b=n.canvas.width-(n.lastOpts&&n.lastOpts.useAlpha?60:30),c=n.canvas.height;if(n.lastOpts.radial){var d=[b/2,c/2],e=[a.offsetX-1-d[0],-(a.offsetY-1)+d[1]],f=Math.atan2(e[1],e[0])/(2*Math.PI)+.5,g=Math.sqrt(e[0]*e[0]+e[1]*e[1])/Math.min(d[0],d[1]);(0!==a.screenX||0!==a.screenY)&&n.color({h:f,s:Math.min(g,1)})}else(0!==a.screenX||0!==a.screenY)&&n.color({h:Math.min(1,Math.max(0,(a.offsetX-1)/b)),s:Math.min(1,Math.max(0,(c-a.offsetY+1)/(c-1)))})},p.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},p.ondrag=p.onmousedown=function(a){var b=n.canvas.height;(0!==a.screenX||0!==a.screenY)&&n.color({v:Math.max(0,Math.min(1,(b-a.offsetY-1)/(b-1)))})},q.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},q.ondrag=q.onmousedown=function(a){var b=n.canvas.height;(0!==a.screenX||0!==a.screenY)&&n.color({a:Math.max(0,Math.min(1,(b-a.offsetY-1)/(b-1)))})};var r,s;a(this.elem.querySelector(".r"),"r"),a(this.elem.querySelector(".g"),"g"),a(this.elem.querySelector(".b"),"b"),a(this.elem.querySelector(".a"),"a")}},rebind:function(a,b){var c=window.getComputedStyle(this.elem.querySelector(".palette")),d=parseInt(c.width),e=parseInt(c.height)-4;this.gl.uniform2f(this.gl.getUniformLocation(this._program,"windowDimensions"),d,e),this.gl.uniform1i(this.gl.getUniformLocation(this._program,"useAlpha"),!!a),this.gl.uniform1i(this.gl.getUniformLocation(this._program,"radial"),!!b)},placePopup:function(a,b){a.stopPropagation();var c=window.getComputedStyle(this.elem),d=parseInt(c.width)||0,e=parseInt(c.height)||0,f=a.target.getBoundingClientRect(),g={x:(f.left+f.right)/2,y:(f.top+f.bottom)/2},h=20;/^[ns]?[we]?$/.test(b)&&b||(b="se"),/^n/.test(b)?this.elem.style.top=g.y-e-h+"px":/^s/.test(b)?this.elem.style.top=g.y+h+"px":this.elem.style.top=g.y-e/2+"px",/e$/.test(b)?this.elem.style.left=g.x+h+"px":/w$/.test(b)?this.elem.style.left=g.x-d-h+"px":this.elem.style.left=g.x-d/2+"px",this.elem.style.display=""},sizePopup:function(a,b){this.elem.setAttribute("class",b);var c=window.getComputedStyle(this.elem);this._popupWidth=parseInt(c.width)||0,this._popupHeight=parseInt(c.height)||0;var d=window.getComputedStyle(this.elem.querySelector(".palette")),e=parseInt(d.width),f=parseInt(d.height)-4;this.canvas.width=e,this.canvas.height=f,this.gl.viewport(0,0,e,f);var g=a?e-60:e-30,h=this.elem.querySelector(".twoaxis"),i=this.elem.querySelector(".oneaxis"),j=this.elem.querySelector(".alpha");h.style.width=g+"px",h.style.height=f+"px",i.style.height=f+"px",j.style.height=f+"px",a||(j.style.display="none",this.elem.querySelector(".rgbInput .a").style.display="none",h.style.left="0px")},color:function(a){if(void 0===this.selection.a&&(this.selection.a=1),a&&void 0!==a.a&&(this.selection.a=a.a),!a)return this.selection;if(void 0!==a.h||void 0!==a.s||void 0!==a.v){void 0!==a.h&&(this.selection.h=a.h),void 0!==a.s&&(this.selection.s=a.s),void 0!==a.v&&(this.selection.v=a.v);var b=c(this.selection.h,this.selection.s,this.selection.v);this.selection.r=Math.max(b.r,0),this.selection.g=Math.max(b.g,0),this.selection.b=Math.max(b.b,0),this.selection.hex=("00"+Math.round(255*this.selection.r).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.g).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.b).toString(16)).slice(-2)}else if(void 0!==a.r||void 0!==a.g||void 0!==a.b){void 0!==a.r&&(this.selection.r=a.r),void 0!==a.g&&(this.selection.g=a.g),void 0!==a.b&&(this.selection.b=a.b);var e=d(this.selection.r,this.selection.g,this.selection.b);this.selection.h=e.h,this.selection.s=e.s,this.selection.v=e.v,this.selection.hex=("00"+Math.round(255*this.selection.r).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.g).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.b).toString(16)).slice(-2)}else if(/^[0-9A-Fa-f]{6}$/.test(a)){this.selection.hex=a,a=parseInt(a,16),this.selection.r=((16711680&a)>>16)/255,this.selection.g=((65280&a)>>8)/255,this.selection.b=(255&a)/255;var e=d(this.selection.r,this.selection.g,this.selection.b);this.selection.h=e.h,this.selection.s=e.s,this.selection.v=e.v}if(a){this.redraw(),this.elem.querySelector(".rgbInput .r").innerHTML=this.selection.hex.slice(0,2),this.elem.querySelector(".rgbInput .g").innerHTML=this.selection.hex.slice(2,4),this.elem.querySelector(".rgbInput .b").innerHTML=this.selection.hex.slice(4,6),this.elem.querySelector(".rgbInput .a").innerHTML=("00"+Math.round(255*this.selection.a).toString(16)).slice(-2);var f=[Math.round(255*this.selection.r),Math.round(255*this.selection.g),Math.round(255*this.selection.b),this.selection.a];f="rgba("+f.join(",")+")",this.elem.querySelector(".colorswatch").style.background="linear-gradient("+f+","+f+"), url("+i+")",this.colorCallback&&this.colorCallback(this.selection)}},redraw:function(){var a=this.gl.getUniformLocation(this._program,"selectedColor");this.gl.uniform4f(a,this.selection.h,this.selection.s,this.selection.v,this.selection.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},show:function(a,b){this.lastOpts=a,a=a||{},this.placePopup(b,a.popupEdge),this.sizePopup(a.useAlpha,a.css),this.rebind(a.useAlpha,a.radial),this.color(a.color)},hide:function(){this.elem.style.display="none",this.colorCallback=null}};if(e.prototype.color=function(a){return a?void(j.triggerElem===this.triggerElem?j.color(a):(this.color=a,this.colorCallback(a))):this.color},e.prototype.destroy=function(){this.triggerElem.removeEventListener("click",this._clickHandler),j.triggerElem===this.triggerElem&&j.hide()},window.HtmlPalette=e,window.HtmlPalette.PalettePopup=j,a&&a.fn.extend({HtmlPalette:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.data("HtmlPalette");if(!a)return c;if(a instanceof Object)c&&c.destroy(),c=this.data("HtmlPalette",new HtmlPalette(this[0],a)),c.colorCallback&&(c.colorCallback=c.colorCallback.bind(this));else{if(!c)throw new Error("HtmlPalette is uninitialized on this element");switch(a){case"color":if(!b.length)return c.color();c.color(b[0]);break;case"colorCallback":if(!b.length)return c.colorCallback;c.colorCallback=b[0].bind(this);break;case"popupEdge":if(!b.length)return c.popupEdge;c.popupEdge=b[0];break;case"radial":if(!b.length)return c.radial;c.radial=b[0];break;case"updateTriggerBg":if(!b.length)return c.updateTriggerBg;c.updateTriggerBg=b[0];break;case"disabled":if(!b.length)return c.disabled;c.disabled=b[0];break;case"destroy":c.destroy(),this.data("htmlPalette",null)}}}}),b){var k=b.module("html-palette",[]);k.directive("htmlPalette",["$timeout",function(a){return{restrict:"AE",scope:{hsvColor:"=",rgbColor:"=",hexColor:"=",radial:"=",disabled:"="},link:function(b,c,d){var e=new HtmlPalette(c[0],d),f=!1,g=!1,h=null,i=parseInt(d.throttleApply)||0;b.$watch("radial",function(a){e.radial=!!a}),b.$watch("disabled",function(a){e.disabled=!!a}),c.bind("$destroy",function(){e.destroy()}),d.hsvColor?(e.colorCallback=function(c){f||(g=!0,h&&a.cancel(h),h=a(function(){b.hsvColor.h=c.h,b.hsvColor.s=c.s,b.hsvColor.v=c.v,b.hsvColor.a=c.a,b.$apply(),h=null,g=!1},i))},b.$watchCollection("hsvColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.hsvColor)):d.rgbColor?(e.colorCallback=function(c){f||(g=!0,h&&a.cancel(h),h=a(function(){b.rgbColor.r=c.r,b.rgbColor.g=c.g,b.rgbColor.b=c.b,b.rgbColor.a=c.a,b.$apply(),h=null,g=!1},i))},b.$watchCollection("rgbColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.rgbColor)):d.hexColor&&(e.colorCallback=function(c){f||(g=!0,h&&a.cancel(h),h=a(function(){b.hexColor=c.hex,b.$apply(),h=null,g=!1},i))},b.$watch("hexColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.hexColor))}}}])}}(window.jQuery,window.angular);